<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>任务列表</title>
</head>
<script src="/task-mgr/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript">
/*  
	//获取完成任务数/总任务数
	$(function(){
		$.ajax({
			//请求方式
			type : "POST",
			//请求的媒体类型
			dataType:"text",
			//请求地址${pageContext.request.contextPath}
			url : "/task-mgr/task/getPercentOfCompletedTasks",
            
			//请求成功
			success : function(data) {
				console.log(data); 
				$('#percentOfCompletedTasks').html("完成度:"+data+"%");
			},
			//请求失败，包含具体的错误信息
			error : function(e){
				console.log(e.status);
				console.log(e.responseText);
			}
		});
	}); 
*/ 
</script>
<body>
<form action="" method="get">
	<table border="1" width="80%" align="center">
		<thead>
			<tr>
				<th colspan="10" align="center">
				任务列表
				</th>
			</tr>
			<tr>
				<td colspan="10" align="center">
					<span id="percentOfCompletedTasks" align="left">111</span>
				</td>
			</tr>
		</thead>
		<tr>
			<td align='center' width='2.5%'>全选</td>
			<td align="center" width="10%">任务</td>
			<td align='center' width='*%'>任务描述</td>
			<td align="center" width="6%">优先级</td>
			<td align="center" width="4%">日常任务</td>
			<td align="center" width="10%">预期时间</td>
			<td align="center" width="10%">实际时间</td>
			<td align="center" width="10%">创建时间</td>
			<td align="center" width="10%">更新时间</td>
			<td align="center" width="5%">已完成</td>
		</tr>
		#foreach($!task in $!tasks)
		<tr>
			<td align="center"><input type="checkbox"  name="ids"/></td>
			<td align="center">$!task.content</td>
			<td align="center">$!task.desc</td>
			
			##优先级
			<td align="center">
			#if ($!task.priority == 1)
			重要<br/>紧急
			#elseif ($!task.priority == 2)
			重要<br/>不紧急
			#elseif ($!task.priority == 3)
			不重要<br/>紧急
			#elseif ($!task.priority == 4)
			不重要<br/>不紧急
			#end
			</td> 
			
			##日常任务
			<td align="center">
			#if($!task.isHabit == 0)
			否 
			#elseif ($!task.isHabit == 1)
			是
			#end
			</td>
			
			<td align="left">
			#foreach($!timeExpected in $!task.timeExpecteds)
			##预期开始时间
				$!dateTool.format('HH:mm',$!timeExpected.beginTimeExpected)-
			##预期结束时间
			$!dateTool.format('HH:mm',$!timeExpected.endTimeExpected)</br>
			#end
			</td> 
			
			<td align="left">
			#foreach($!timeActual in $!task.timeActuals)
			##实际开始时间
			$!dateTool.format('HH:mm',$!timeActual.beginTimeActual)-
			##实际结束时间
			$!dateTool.format('HH:mm',$!timeActual.endTimeActual)</br>
			#end
			</td> 
			
			<td align="center">$!dateTool.format('yyyy-MM-dd HH:mm:ss',$!task.createTime)</td>
			<td align="center">$!dateTool.format('yyyy-MM-dd HH:mm:ss',$!task.updateTime)</td>
			
			##已完成
			<td align="center">
			#if($!task.isComplete == 0)
			否
			#elseif($!task.isHabit == 1)
			是
			#end
			</td>
		</tr>
		#end
	</table>
</form>
<!-- 搜索 -->
<table align="center" width="50%" border="1" onchange="search()">
	<tr>
		<td align="center">任务</td>
		<td align="center">任务描述</td>
		<td align="center">优先级</td>
		<td align="center">日常任务</td>
		<td align="center">已完成</td>
	</tr>
	<tr>
		<td align="left"><input type="text" name="content" id="searTabContent"></td>
		<td align="left"><input type="text"  name="desc" id="searTabDesc"></td>
		<td align="left">
			<select  name="priority" id="searTabPriority">
				<option value="1">重要紧急</option>
				<option value="2">重要不紧急</option>
				<option value="3">不重要紧急</option>
				<option value="4">不重要不紧急</option>
			</select>
		</td>
		<td align="left">
			<select  name="isHabit" id="searTabIsHabit">
				<option value="0">否</option>
				<option value="1">是</option>
			</select>
		</td>
		<td align="left" >
			<select  name="isComplete" id="searTabIsComplete">
				<option value="0">否</option>
				<option value="1">是</option>
			</select>
		</td>
	</tr>
</table>

<!-- 分页 -->
##一页大小
#set($pageSize = 4)
#set($page2 = $totalCount/$pageSize)
#set($page1 = $totalCount/$pageSize+1)
##设置总页数
#if($totalCount/$pageSize ==0)
	#if($totalCount<$pageSize)
		#set($pages = $page2+1)
	#else
		#set($pages = $page2)
	#end 
#else 
	#set($pages = $page1)  
#end
##当前页
#set($pre1_page = $pageNo - 1)
#set($pre2_page = $pageNo - 2)
#set($next1_page = $pageNo + 1)
#set($next2_page = $pageNo + 2)
<h2 align="center">
#if($pages > 1)
	#if($pageNo>1)
		<a href="javascript:;" onclick="firstPage()">首页</a>
		<a href="javascript:;" onclick="prePage()">上页</a>
	#end
	#if($pre2_page >=1)
		<a href="javascript:;" onclick="pre2Page()">$pre2_page</a>
	#end
	#if($pre1_page >=1)
		<a href="javascript:;" onclick="prePage()">$pre1_page</a>
	#end
		<a href="javascript:;" disabled> $pageNo</a>
	#if($next1_page <=$pages)
		<a href="javascript:;" onclick="nextPage()">$next1_page</a>
	#end
	#if($next2_page <=$pages)
		<a href="javascript:;" onclick="next2Page()">$next2_page</a>
	#end
	#if($pageNo < $pages)
		<a href="javascript:;" onclick="nextPage()">下页</a>
		<a href="javascript:;" onclick="lastPage()">尾页</a>
	#end
#end 
	#if($pages>0)
	 当前第<span>$pageNo</span>页,共<span id="pages">$pages</span>页 
	 <input type="text" id= "index" style="width:30px"><a href="javascript:void(0)" onClick="jump()">跳转</a>
 #else
	没有找到东西
 #end
 </h2>
</body>
<script type="text/javascript">
	//获取URL
	var $url = location.href;
	var content = document.getElementById("searTabContent").value;
	var desc = document.getElementById("searTabDesc").value;
	var priority = document.getElementById("searTabPriority").value;
	var isHabit = document.getElementById("searTabIsHabit").value;
	var isComplete = document.getElementById("searTabIsComplete").value;
	$url = $url.split("?", 1)[0];
	var pages =document.getElementById("pages").innerHTML;
	//搜索方法
	function search(){
		window.location.href = $url+"?pageNo="+pages+"&pageSize="+$pageSize+"&content="
				+content+"&desc="+desc+"&priority="+priority+"&isHabit="
				+isHabit+"&isComplete="+isComplete;
	}
	//分页方法
	//跳转到指定页码
	function jump(){
		var $targetPage = document.getElementById("index").value;
		if($targetPage != null && $targetPage>0 && $targetPage<=pages){//有输入值，并且输入值在1到总页数之间才跳转。
			window.location.href = $url + "?pageNo=" + $targetPage + "&pageSize=" + $pageSize+"&content="
			+content+"&desc="+desc+"&priority="+priority+"&isHabit="
			+isHabit+"&isComplete="+isComplete;
		}
	};
	//首页
	function firstPage(){
		window.location.href = $url + "?pageNo=1&pageSize=" + $pageSize+"&content="
		+content+"&desc="+desc+"&priority="+priority+"&isHabit="
		+isHabit+"&isComplete="+isComplete;
	};
	//上页
	function prePage(){
		var $prePage = ${pageNo}-1;
		window.location.href = $url + "?pageNo=" + $prePage + "&pageSize=" + $pageSize+"&content="
		+content+"&desc="+desc+"&priority="+priority+"&isHabit="
		+isHabit+"&isComplete="+isComplete;
	};
	//上上页
	function pre2Page(){
		var $pre2Page = ${pageNo}-2;
		window.location.href = $url + "?pageNo=" + $pre2Page + "&pageSize=" + $pageSize+"&content="
		+content+"&desc="+desc+"&priority="+priority+"&isHabit="
		+isHabit+"&isComplete="+isComplete;
	};
	//当前页
	function currPage(){
		window.location.href = $url + "?pageNo=" + $pageNo + "&pageSize=" + $pageSize+"&content="
		+content+"&desc="+desc+"&priority="+priority+"&isHabit="
		+isHabit+"&isComplete="+isComplete;
	};
	//下页
	function nextPage(){
		var $nextPage = ${pageNo}+1;
		window.location.href = $url + "?pageNo=" + $nextPage + "&pageSize=" + $pageSize+"&content="
		+content+"&desc="+desc+"&priority="+priority+"&isHabit="
		+isHabit+"&isComplete="+isComplete;
	};
	//下下页
	function next2Page(){
		var $next2Page = ${pageNo}+2;
		window.location.href = $url + "?pageNo=" + $next2Page + "&pageSize=" + $pageSize+"&content="
		+content+"&desc="+desc+"&priority="+priority+"&isHabit="
		+isHabit+"&isComplete="+isComplete;
	};
	//尾页
	function lastPage(){
		window.location.href = $url + "?pageNo=" + pages + "&pageSize=" + $pageSize+"&content="
		+content+"&desc="+desc+"&priority="+priority+"&isHabit="
		+isHabit+"&isComplete="+isComplete;
	};
</script>
</html>